\lstset {
basicstyle=\tiny\ttfamily
,escapeinside= {!}{!}
}


\begin{overprint}
\begin{tikzpicture}[remember picture, stop jumping, constrain]
  \node (code) [anatomy] at (0,0) {
    \begin{lstlisting}[
      style=ksty
      ,language=k
      ,basicstyle=\ttfamily\scriptsize
      ]
    configuration
     !\mtPoint{mostLeft}! <instance multiplicity="*" type="Map"> ... !\extremPoint{mostRight}!
      !\mtPoint{mostLeftK}!<k> $PGM </k>!\extremPoint{mostRightK}\mbPoint{mostBottomK}!
        <env> .Map </env>
        <inBuffer> .List </inBuffer>
      </instance>!\mbPoint{mostBottom}!
     !\mtPoint{mostLeftMachine}! <machine multiplicity="*" type="Map"> ... !\extremPoint{mostRightMachine}!
        <machineName> . </machineName>
        <states>
          <state multiplicity="*" type="Map">
            <stateName> . </stateName>
            <entryBlock> . </entryBlock>
            <eventHandlers> ... </eventHandlers>
          </state>
        </states>
      </machine>!\mbPoint{mostBottomMachine}!
    \end{lstlisting}
  };
\only<2->{
  \fitExtrem{instanceBox}{(mostLeft) (mostRight) (mostBottom)}
  \codeAnnotation{instanceBoxAnnotation} (10.35,5) {State of \\ running instance} {[on background layer]}
  \draw[->,annotation] (instanceBox) -- (instanceBoxAnnotation);
};
\only<3->{
  \fitExtrem{KBox}{(mostLeftK) (mostRightK) (mostBottomK)}
  \codeAnnotation{KBoxAnnotation} (6.45,5.25) {\MediK{} Program} {[on background layer]}
  \draw[->,annotation] (KBox) -- (KBoxAnnotation);
};

\only<4->{
  \fitExtrem{MachineBox}{(mostLeftMachine) (mostRightMachine) (mostBottomMachine)}
  \codeAnnotation{MachineBoxAnnotation} (10.25,2.3) {Machine \\ Definitions} {[on background layer]}
  \draw[->,annotation] (MachineBox) -- (MachineBoxAnnotation);
};
\end{tikzpicture}
\end{overprint}
